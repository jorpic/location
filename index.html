<!DOCTYPE html><html><head><title>− Определение местоположения</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta charset="utf-8"><style>body{display:flex;flex-direction:column;height:100vh;max-width:50rem;margin:auto;font-family:sans-serif}.bar{background-color:#1e90ff;color:#fff}.bar,.info{padding:.5em}.info{display:flex;justify-content:space-between;align-items:center;background-color:azure}.info.err{background-color:#ffe4e1}.info.done{background-color:#f5fffa}.info p{margin:0}button{background:none;border:3px solid #000;border-radius:.7em;padding:.5em;min-width:12em}button:active{transform:scale(.95)}svg{display:flex;flex:1}</style></head><body><div class="bar">Лого и название программы</div><div class="info welcome"><p>Нажмите кнопку, чтобы определить ваше местоположение.</p><button onclick="getCoords()">Начать</button></div><div class="info err"><p>Что-то пошло не так.</p><button onclick="getCoords()">Попробовать ещё</button></div><div class="info ok"><div><p>Ура! Мы определили ваше местоположение, откорректируйте его если надо и не забудьте отправить.</p><p id="info1"></p><p id="info2"></p></div><button onclick="sendCoords()">Отправить</button></div><div class="info done"><p>Спасибо, мы уже спешим к вам.</p></div><svg id="svg"><g id="tiles"></g><g id="pin"><g transform="translate(-12 -36) scale(0.5)" fill="#880096"><path d="M24,0 C11,0 0,10 0,22 C0,35 10,50 24,72 C37,50 48,35 48,22 C48,10 36,0 24,0 L24,0 Z M24,33 C19,33 15,28 15,24 C15,19 19,15 24,15 C28,15 33,19 33,24 C33,28 28,33 24,33 L24,33 Z"></path></g></g></svg><script>function t(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=n(t))){var o=0,e=function(){};return{s:e,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,i=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function n(t,n){if(t){if("string"==typeof t)return o(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,n):void 0}}function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var o=0,e=new Array(n);o<n;o++)e[o]=t[o];return e}var e=function(t,n,o){return n.split(" ").map(function(n){return t.addEventListener(n,o,!1)})},r=function(t){return document.getElementById(t)},a=r("info"),i=r("svg"),c=16,u=Math.pow(2,c-1),l=255,f=Math.PI;function s(t){var n=t.lon,o=t.lat*f/180;return{x:(n+180)/180*u,y:(1-Math.log(Math.tan(o)+1/Math.cos(o))/f)*u}}function d(t){var n=t.x,o=t.y;return{lon:180*(n/u-1),lat:180*Math.atan(Math.sinh(f*(1-o/u)))/f}}var h={tiles:r("tiles"),pin:r("pin"),dx:0,dy:0};function y(t){h.lon=t.lon,h.lat=t.lat;var n=s(t),o=n.x,r=n.y,a=Math.floor(o),i=Math.floor(r);h.originX=a,h.originY=i;for(var u=0,f=[-1,0];u<f.length;u++)for(var d=f[u],y=0,v=[-1,0];y<v.length;y++){var m=v[y],p=document.createElementNS("http://www.w3.org/2000/svg","image"),w="abc"[Math.floor(12*Math.random())%3];p.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","https://".concat(w,".tile.openstreetmap.org/").concat(c,"/").concat(a+d,"/").concat(i+m,".png")),p.setAttribute("x",l*d),p.setAttribute("y",l*m),h.tiles.appendChild(p)}g(l*(o-a),l*(r-i)),e(window,"orientationchange resize",function(){return g(0,0)})}function g(t,n){h.dx+=t,h.dy+=n;var o=Math.floor(i.clientWidth/2),e=Math.floor(i.clientHeight/2);h.pin.setAttribute("transform","translate(".concat(o," ").concat(e,")")),h.tiles.setAttribute("transform","translate(".concat(o-h.dx," ").concat(e-h.dy,")"));var a=d({x:h.originX+h.dx/l,y:h.originY+h.dy/l}),c=a.lon,u=a.lat;r("info2").textContent="(".concat(u.toFixed(6),", ").concat(c.toFixed(6),")")}function v(){var t,n,o=function(t){return t.touches?t.touches[0]:t},r=!1;e(i,"mousedown touchstart",function(e){e.preventDefault(),r=!0;var a=o(e);t=a.pageX,n=a.pageY}),e(i,"mousemove touchmove",function(e){if(r){var a=o(e);g(t-a.pageX,n-a.pageY),t=a.pageX,n=a.pageY}}),e(document.body,"mouseup",function(t){r=!1})}function m(t){var n={lat:t.coords.latitude,lon:t.coords.longitude,accuracy:t.coords.accuracy};r("info1").textContent="(".concat(n.lat,", ").concat(n.lon,")")+" с точностью ±".concat(n.accuracy.toFixed(1)," метров."),w("ok"),y(n),v()}function p(t){m({coords:{latitude:55.583357,longitude:37.596508,accuracy:11}}),v()}function w(n){var o,e=t(document.getElementsByClassName("info"));try{for(e.s();!(o=e.n()).done;){var r=o.value;r.style.display=r.classList.contains(n)?"flex":"none"}}catch(a){e.e(a)}finally{e.f()}}function x(){navigator.geolocation.getCurrentPosition(m,p)}function b(){w(Math.random()>.5?"done":"err")}w("welcome");</script></body></html>