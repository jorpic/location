<!DOCTYPE html><html><head><title>− Определение местоположения</title><meta charset="utf-8"><style>*{margin:0;padding:0}body{flex-flow:column;height:100vh;max-width:50rem;margin:auto}body,header{display:flex}header{flex-flow:row wrap;justify-content:space-between;align-items:center;padding:.5em}@media (orientation:portrait){header *{margin:.5em 1em}header button{max-width:40%}header .info{order:1;width:100%}}content{flex-grow:1;border:1px solid green}svg{width:100%;height:100%;border:1px solid red}</style></head><body><header><h1>VW</h1><p class="info">Помощь на дорогах</p><button>Отправить координаты</button></header><content><svg id="svg" preserveAspectRatio="none"><g id="map"></g><g id="pin"><g transform="translate(-12 -36) scale(0.5)" fill="#880096"><path d="M24,0 C11,0 0,10 0,22 C0,35 10,50 24,72 C37,50 48,35 48,22 C48,10 36,0 24,0 L24,0 Z M24,33 C19,33 15,28 15,24 C15,19 19,15 24,15 C28,15 33,19 33,24 C33,28 28,33 24,33 L24,33 Z"></path></g></g></svg></content><script>var t=function(t){return document.getElementById(t)},n=t("info"),o=t("svg"),e=16,a=Math.pow(2,e-1),r=255,c=Math.PI;function u(t){var n=t.lon,o=t.lat*c/180;return{x:(n+180)/180*a,y:(1-Math.log(Math.tan(o)+1/Math.cos(o))/c)*a}}function i(t){var n=t.x,o=t.y;return{lon:180*(n/a-1),lat:180*Math.atan(Math.sinh(c*(1-o/a)))/c}}var l={el:t("map"),pin:t("pin"),dx:0,dy:0},s=Math.floor(o.clientWidth/2),h=Math.floor(o.clientHeight/2);function f(t){for(var n=u(t),o=n.x,a=n.y,c=Math.floor(o),i=Math.floor(a),f=0,g=[-1,0];f<g.length;f++)for(var p=g[f],m=0,v=[-1,0];m<v.length;m++){var M=v[m],w=document.createElementNS("http://www.w3.org/2000/svg","image"),x="abc"[Math.floor(12*Math.random())%3];w.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","https://".concat(x,".tile.openstreetmap.org/").concat(e,"/").concat(c+p,"/").concat(i+M,".png")),w.setAttribute("x",r*p),w.setAttribute("y",r*M),l.el.appendChild(w)}l.pin.setAttribute("transform","translate(".concat(s," ").concat(h,")")),d(r*(o-c),r*(a-i))}function d(t,n){l.dx+=t,l.dy+=n,l.el.setAttribute("transform","translate(".concat(s-l.dx," ").concat(h-l.dy,")")),console.log(l)}function g(){var t,n,e=function(t){return t.touches?t.touches[0]:t},a=!1;function r(o){o.preventDefault(),a=!0;var r=e(o);t=r.pageX,n=r.pageY}function c(o){if(a){var r=e(o);d(t-r.pageX,n-r.pageY),t=r.pageX,n=r.pageY}}var u=function(t,n,o){return t.addEventListener(n,o,!1)};u(o,"mousedown",r),u(o,"touchstart",r),u(o,"mousemove",c),u(o,"touchmove",c),u(document.body,"mouseup",function(t){a=!1})}function p(t){t.coords.latitude,t.coords.longitude,t.coords.accuracy,new Date,t.timestamp,Date.now()}function m(t){console.log(t),n.textContent="Не удалось определить координаты: "+t.message}f({lat:55.583357,lon:37.596508}),g();</script></body></html>